(function(){"use strict"})();var appWoG={CACHE_DUR:864e5,init:function(){var n=window.onerror;window.onerror=function(t,i,r){$(".busy").remove();var u="error: ";t&&t.length&&(u=u+t);i&&(u=u+", url: "+i);r&&(u=u+", linenumber: "+r);console.log(u);n&&n()};this.isNative=!1;this.netIsOn=!0;this.bacon=window.Bacon;this.gapi=window.gapi;document.addEventListener("deviceready",function(){appWoG.phonegapInit.call(appWoG)},!1);syncInit.compTask();this.loadHtmlFragment("navheader_m",this.addMNavHeaderFrag);this.netIsOn&&this.loadHtmlFragment("section_m",this.addMainListFrag);this.plistsTempBcProp=this.getHtmlAsProp("plist_templ",!0);this.videosListTempBcProp=this.getHtmlAsProp("vidlist_templ",!0);this.vidNavFragBcProp=this.getHtmlAsProp("navheader_v",!1);$(".top").on("singletap",function(){$("article.current").scrollTop(0)});$.subscribe("chui/navigate/enter",this.navEnter);$.subscribe("chui/navigateBack/leave",this.navBackLeave);this.setVideoTapPlayEvent(this.env)},loadHtmlFragment:function(n,t){n+=".min.html";this.bacon.fromPromise($.ajax({url:appWoGServer+n,cache:!1})).mapError(this.getLocalFile,n,t).onValue(t)},getLocalFile:function(n,t){$.get(n,function(n){t(n)});var i="File failed to load from m.WoG.gr. Opted for the local instead: "+n;Rollbar.info(i);console.log(i)},getHtmlAsProp:function(n,t){n+=".min.html";var i=this;return Bacon.fromPromise($.ajax({url:appWoGServer+n,cache:!1})).flatMapError(function(){return i.getLocalFileAsProm(n)}).map(function(n){return t?$.template(n):n}).toProperty()},getLocalFileAsProm:function(n){var t="File failed to load from m.WoG.gr. Opted for the local instead: "+n;return Rollbar.info(t),console.log(t),Bacon.fromPromise($.get(n))},addMNavHeaderFrag:function(n){$("#mainNav").append(n);appWoG.updNetIcon();$("#hReload").off("singletap").on("singletap",function(){document.location="index.html"});$("#homeSearch").off("singletap").on("singletap",function(){var n=$(".searchBar");n.length===0?($.UISearch({id:"mainSearchBox",articleId:"#playlists",placeholder:"Αναζήτηση",results:5}),$("#mainSearchBox").focus()):n.remove()});$(".fa-bars").off("singletap").on("singletap",function(){var n=this;$.UIPopover({title:"Περί m.WordofGod.tv",trigger:n,content:appWoG.barsPopoverCont,callback:function(){appWoG.menuPOEvHandler()}})});$(".fa-sort-alpha-asc").off("singletap").on("singletap",function(){var n=this;$.UIPopover({title:"Ταξινόμηση ανά...",trigger:n,content:appWoG.sortPopoverCont,callback:function(){var n=$("article.current").attr("id");appWoG.sortPOEvHandler(n)}})})},addVNavHeaderFrag:function(){var n=$("#videosNav");if(n.html().indexOf("table")===-1)this.vidNavFragBcProp.onValue(function(t){n.append(t);appWoG.updNetIcon();$("#backToMain").off("singletap").on("singletap",function(){$.UIGoBackToArticle("#playlists")});$("#vReload").off("singletap").on("singletap",function(){if(appWoG.netIsOn){var n=$("#videosList").data("id");appWoG.gapiLoadVideos(n)}else document.location="index.html"});$(".fa-bars").off("singletap").on("singletap",function(){var n=this;$.UIPopover({title:"Περί m.WordofGod.tv",trigger:n,content:appWoG.barsPopoverCont,callback:function(){appWoG.menuPOEvHandler()}})})});else appWoG.updNetIcon()},addMainListFrag:function(n){$("#secPlaylists").prepend(n);setTimeout(function(){$(".liveFlexText").fitText(1.1)},0);appWoG.setTouchPlayLiveEvent();appWoG.setTouchPlaylistEvent()},lang:"el",ytPlayerParams:"?autohide=1&autoplay=1&controls=1&showinfo=0&rel=0&modestbranding=1&&theme=dark&origin=http://"+location.host,cachedLiveLangYtUrl:{el:{vidID:null},en:{}},youtubeLangChannel:{el:"UCc3hweSOwmGb6hdQrPFc_cw",en:"wordofgodenglish"},getYoutubeLangChannel:function(){return this.youtubeLangChannel[this.lang]},listsOrderby:{playlists:"date",videos:"published"},getListOrderby:function(n){return this.listsOrderby[n]},setListOrderby:function(n,t){this.listsOrderby[n]=t},getYTUrl:function(n){var t="";return n!==void 0&&(t="http://www.youtube.com/embed/"+n+this.ytPlayerParams),t},barsPopoverCont:"<ul class='list'><li data-opt='en'><h3>English<\/h3><h6>...under construction<\/h6><\/li><li data-opt='about'><i class='fa fa-info-circle fa-3x'><\/i><h3>About Word of God Mobile<\/h3><\/li><\/ul>",sortPopoverCont:"<ul class='list'><li class='comp' data-opt='date'><aside><i class='fa fa-3x fa-newspaper-o'><\/i><\/aside><div><h3>Πρόσφατες εγγραφές<\/h3><\/div><aside><h4>Φθίνουσα<\/h4><span class='nav'><\/span><\/aside><\/li><li class='comp' data-opt='rating'><aside><i class='fa fa-3x fa-heart-o'><\/i><\/aside><div><h3>Αξιολόγηση θεατών<\/h3><\/div><aside><h4>Φθίνουσα<\/h4><span class='nav'><\/span><\/aside><\/li><li class='comp' data-opt='viewCount'><aside><i class='fa fa-3x fa-sort-numeric-desc'><\/i><\/aside><div><h3>Αριθμός θέασης<\/h3><\/div><aside><h4>Φθίνουσα<\/h4><span class='nav'><\/span><\/aside><\/li><\/ul>",cachedPL:{ts:null,resp:null,orderBy:null},cachedVideos:{ts:null,resp:null,orderBy:null},sortPOEvHandler:function(n){$(".popover").on("singletap",function(t){if(appWoG.netIsOn){var r,i;t.target.nodeName==="LI"?i=t.target.data("opt"):(r=$($(t.target).closest("li")[0]),i=r.data("opt"));appWoG.setListOrderby(n,i);appWoG.gapiLoadPlaylists(i)}$.UIPopoverClose()})},vertAlign:function(n){var t=Math.ceil(($(window).height()*.8-$(n).height())/2);$(n).css("margin-top",t+"px")},menuPOEvHandler:function(){$(".popover").on("singletap",function(n){var r,t,i;if(n.target.nodeName==="LI"?t=n.target.data("opt"):(r=$($(n.target).closest("li")[0]),t=r.data("opt")),t==="about"){if($.UISheet({id:"abSheet",handle:!1}),i=$(".sheet").find("section"),i.html().indexOf("aboutDiv")===-1){i.append("<div id='aboutDiv' class='hcenter'><img src='css/images/WOG_icon_36x36.png' alt='WoG'><h6>version 1.0.508<\/h6><p>Τετάρτη 20 Μαίου 2015<\/p><h6>Το www.WordofGod.gr τώρα και στις κινητές συσκευές.<\/h6><\/div>");$(".sheet").on("singletap",function(){$.UIHideSheet()});$(window).on("resize",function(){appWoG.vertAlign("#aboutDiv")})}$.UIShowSheet("#abSheet");$.UIPopoverClose();appWoG.vertAlign("#aboutDiv")}else t==="exit"&&appWoG.isNative&&navigator.app.exitApp()})},navEnter:function(n,t){t==="videos"&&appWoG.addVNavHeaderFrag()},navBackLeave:function(n,t){if(!this.isNative)switch(t){case"ytIFrmArticle":$("#video-iframe").attr("src","")}},updNetIcon:function(){this.netIsOn?$(".fa-ban").removeClass("fa-ban"):$(".ban-icon").addClass("fa-ban")},showNoNetPopup:function(n,t,i){var r="Δεν έχετε δυκτυακή σύνδεση! Παρακαλώ συνδεθείτε και πατήστε Ok";$.UIPopup({id:"noNetPopup",title:"Εκτός δυκτύου",message:n||t?r:r+" τη θέαση του WordofGod Video.",cancelButton:"ΑΡΓΟΤΕΡΑ",continueButton:"OK ΣΥΝΔΕΘΗΚΑ",callback:i})},checkConnection:function(){var t=navigator.connection.type,n;t!==Connection.NONE?this.netIsOn=!0:(this.netIsOn=!1,this.showNoNetPopup(!0,!1,function(){document.location="index.html"}));this.updNetIcon();n={};n[Connection.UNKNOWN]="Unknown connection";n[Connection.ETHERNET]="Ethernet connection";n[Connection.WIFI]="WiFi connection";n[Connection.CELL_2G]="Cell 2G connection";n[Connection.CELL_3G]="Cell 3G connection";n[Connection.CELL_4G]="Cell 4G connection";n[Connection.CELL]="Cell generic connection";n[Connection.NONE]="No network connection";console.log("Connection type: "+n[t])},onOffline:function(){appWoG.netIsOn=!1;appWoG.updNetIcon()},onOnline:function(){appWoG.getLiveYtVidID()===null&&(document.location="index.html");appWoG.netIsOn=!0;appWoG.updNetIcon()},phonegapInit:function(){navigator.splashscreen.hide();this.checkConnection();document.addEventListener("offline",this.onOffline,!1);document.addEventListener("online",this.onOnline,!1);navigator.notification&&(window.alert=function(n){navigator.notification.alert(n,null,"WoGTVm","OK")});this.isNative=!0},showNoYtPopup:function(n,t){$.UIPopup({id:"noYtPopup",title:"Η εφαρμογή YouTube δεν είναι εγκατεστημένη",message:"Παρακαλώ εγκαταστήσετε την εφαρμογή YouTube από το Google playstore για τη θέαση του WordofGod Video.",cancelButton:"ΑΡΓΟΤΕΡΑ",continueButton:"ΟΚ ΤΗΝ ΕΓΚΑΤΕΣΤΗΣΑ",callback:function(){n||appWoG.phA_playYoutube(n,t)}})},phA_playYoutube:function(n,t){if(t===void 0||t===null){n?(Rollbar.info("Null live id: "+t+" in phA_playYoutube...rebooting"),document.location="index.html"):Rollbar.info("Null id: "+t+" phA_playYoutube");return}this.netIsOn?youtube.playVideo(t,function(){},function(i){var r="window.plugins.youtube.playVideo() failed: ("+i+") to play youtube URL: "+t;Rollbar.error("User has likely not installed youtube. Cannot play: "+t,i);i.indexOf("No Activity")>-1&&appWoG.showNoYtPopup(n,t)}):n?appWoG.showNoNetPopup(!1,n,function(){document.location="index.html"}):appWoG.showNoNetPopup(!1,n,function(){appWoG.phA_playYoutube(n,t)})},getYouTubeID:function(n){var t=n.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/);return t&&t[7].length===11?t[7]:""},setBusySvg:function(n){var t=$(n);t.UIBusy({color:"#444",size:60});t.find(".busy").UICenter()},setTouchPlayLiveEvent:function(){var n=this;$(".liveFlexText").on("singletap",function(t){n.netIsOn&&n.playLiveEvent();t.preventDefault()})},setTouchPlaylistEvent:function(){var n=this;$("#playlistsList").on("singletap","li",function(){var i=$(this),t=i.attr("id"),r;$("#videosList").data("id",t);r=i.data("title");$("#playListTitle").text(r);n.netIsOn?n.gapiLoadVideos(t):appWoG.showNoNetPopup(!0,!1,function(){appWoG.gapiLoadVideos(t)})})},setVideoTapPlayEvent:function(){var n=this;$("#videosList").on("singletap","div",function(t){t.preventDefault();t.stopPropagation();var i=$(this),r=i.find(" > ").data("title"),u=i.find(" > ").data("ytid");n.showYT(!1,r,u)})},showYT:function(n,t,i){if(this.isNative)this.phA_playYoutube(n,i);else{var r=this.getYTUrl(i);$("#video-iframe").attr("src",r);$("#videoTitle").text(t);$.UIGoToArticle("#ytIFrmArticle")}},getLiveYtVidID:function(){return this.cachedLiveLangYtUrl[this.lang].vidID},setLiveYtUrl:function(n){n!==null&&(this.cachedLiveLangYtUrl[this.lang].vidID=n,amplify.store(this.lang+this.liveYtIDKey,n))},playLiveEvent:function(){var n=this.getLiveYtVidID();n&&this.showYT(!0,"Ζωντανή μετάδοση...",n)},loadInit:function(){gapi.client.youtube&&(this.gapiLoadLiveEvent(),this.gapiLoadPlaylists(this.getListOrderby("playlists")))},gapiLoadLiveEvent:function(){var n=this,t={channelId:this.getYoutubeLangChannel(),eventType:"live",part:"id",type:"video",fields:"items/id",maxResults:1};this.gapi.client.youtube.search.list(t).then(function(t){var i=t.result.items;i&&i[0]&&i[0].id&&i[0].id.videoId&&n.setLiveYtUrl(i[0].id.videoId)})},procPlaylistsResp:function(n,t){var r,u,i,f,e;if(!t||"error"in t)"error"in t&&(f=JSON.stringify(t.error.data[0]),f&&(e="gapiLoadPlaylists(), error: "+f,Rollbar.error(e,t.error)));else for(r=$("#playlistsList"),u=t.result.items,r.empty(),i=0;i<u.length;++i)r.append(n(u[i]));$(".busy").remove()},gapiLoadPlaylists:function(n){this.setBusySvg("#mainNav");var t=this;if(!this.cachedPL.resp||!this.cachedPL.ts||!this.cachedPL.orderBy||this.cachedPL.orderBy!==n||Date.now()-this.cachedPL.ts>this.CACHE_DUR)this.gapi.client.youtube.search.list({channelId:this.getYoutubeLangChannel(),part:"id,snippet",type:"playlist",order:n,maxResults:50}).then(function(n){return n.result.items.map(function(n){return n.id.playlistId})}).then(function(n){return gapi.client.youtube.playlists.list({id:n.join(","),part:"id,snippet,contentDetails",type:"playlist",maxResults:50})}).then(function(i){t.plistsTempBcProp.onValue(function(n){t.procPlaylistsResp(n,i)});t.cachedPL={ts:new Date,resp:i,orderBy:n}},function(n){Rollbar.error(n.result)});else this.plistsTempBcProp.onValue(function(n){t.procPlaylistsResp(n,t.cachedPL.resp)})},gapiLoadVideos:function(n){this.setBusySvg("#videosNav");var t=this,i=$("#videosList");i&&i.empty();this.gapi.client.youtube.playlistItems.list({playlistId:n,part:"snippet",maxResults:50}).then(function(n){return n.result.items.map(function(n){return n.snippet.resourceId.videoId})}).then(function(n){return this.gapi.client.youtube.videos.list({id:n.join(","),part:"id,snippet,statistics,contentDetails",maxResults:50})}).then(function(n){t.videosListTempBcProp.onValue(function(i){t.procVideosExtraInfoResp(i,n)})},function(n){Rollbar.error(n.result)})},parseVideoTemp:function(n,t,i){for(var e=/\n*FN\:\w+\.\w+\s*/g,u=0,f="",r=0;r<i;++r)t[r].description=t[r].snippet.description.replace(e,""),t[r].duration=this.convFromIso8601Dur(t[r].contentDetails.duration),u===0?(f+='<div class="ui-block-a">'+n(t[r])+"<\/div>",u++):(f+='<div class="ui-block-b">'+n(t[r])+"<\/div>",u=0);return f},procVideosExtraInfoResp:function(n,t){if(t&&!("error"in t)){var i=t.result.items,r=i.length;r&&$("#videosList").append(appWoG.parseVideoTemp(n,i,r))}$(".busy").remove()},convFromIso8601Dur:function(n){var i=n.match(/\d+/g),t="";return $.each(i,function(n,i){t+=n!==0?":"+("0"+i).slice(-2):("0"+i).slice(-2)}),t}};
//# sourceMappingURL=app.WoG.min.js.map
